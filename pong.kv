#:kivy 2.0.0
<PongBall>:
    size: 60, 60
    canvas:
        Ellipse:
            pos: self.pos
            size: self.size
            source: 'salvagianni.png'

<PongPaddle>:
    size: 25, 200
    canvas:
        Rectangle:
            pos: self.pos
            size: self.size

<PongGame>:
    id: ponggame
    ball: pong_ball
    player1: player_left
    player2: player_right

    canvas:
        Rectangle:
            pos: self.center_x - 5, 0
            size: 10, self.height

    #Winner Popup 1
    Popup:
        id: winner_popup
        title: "Vittoria!"
        on_parent:
            if self.parent == ponggame: self.parent.remove_widget(self)
        size: 400,300
        size_hint: None, None

        LabelChanging:
            id: winner_label
            text: "Vince il giocatore 0!!!"
            center_x: self.width / 2
            center_y: self.height / 2
            font_name: "Oswald"
            font_size: 30
            bold: True
            changing_interval: 0.12
            color_list: ["#ffc600","#fed801", "#fedb16", "#fedc1b","#ffff00","#fedd25","#fee034"]
            color_number_max: 6
            backward_repeat: True

    #Options Popup
    Popup:
        id: opt_popup
        title: "Opzioni"
        on_parent:
            if self.parent == ponggame: self.parent.remove_widget(self)
        on_dismiss:
            root.set_unpause()
        size: 400,400
        size_hint: None, None

        ##The layout is needed here because the popup needs ONLY a widget inside it. So we cheat.
        GridLayout:
            cols: 2
            rows: 6

            ##Wannabe SWITCH TODO
            ToggleButton:
                id: music
                text: 'Musica On/Off'
                size_hint_y: None
                height: 44
                state: "down"
                on_press:
                    root.toggle_music()

            ToggleButton:
                id: sound_effects
                text: 'Suoni On/Off'
                size_hint_y: None
                height: 44
                state: "down"
                on_press:
                    root.toggle_seffects()

            ToggleButton:
                id: winbool
                text: "Vincere On/Off"
                state: "down"
                on_press:
                    root.toggle_winning()
                size_hint_y: None
                height: 44
            TextInput:
                id: winat_input
                text: "Si vince a:"
                size_hint_y: None
                height: 44
                multiline: False

            Button:
                id: close
                text: "Indietro"
                size_hint_y: None
                height: 44
                on_release:
                    opt_popup.dismiss()

            #SLider music TODO
            #Max power points
            #credits for the image freepik coso



    #StartButton
    Button:
        id: avvio
        center_x: root.width / 2
        center_y: root.height / 2 - 60
        top: root.top / 2
        text: "AVVIO"
        size: (110, 40)
        background_color: "cyan"
        on_press:
            self.parent.set_unpause()
            self.parent.serve_ball()
        on_release: self.parent.remove_widget(self)
        bold: True

    #Options button
    Button:
        id: optbutton
        center_x: root.width / 2
        center_y: root.height - 50
        size: 35, 35
        background_normal: 'gear.png'
        background_down: 'gearr.png'
        on_press:
            self.parent.set_pause()
            opt_popup.open()

    ##Freeze Button SX
    Button:
        id: freeze_sx
        center_x: root.width / 8
        center_y: root.height / 12
        size: 35, 35
        background_normal: 'freeze.png'
        background_down: 'freezer.png'
        on_press:
            self.parent.freeze_ballSX()

    ##Freeze Label SX
    LabelChanging:
        id: label_freeze_sx
        text: "6"
        center_x: root.width / 8
        center_y: root.height / 12 + 2
        font_name: "Karantina_Regular"
        font_size: 35
        changing_interval: 0.12
        color_list: ["#4e075f", "#6a0a83", "#870ca6","#af0fd7","#ce40f2"]
        color_number_max: 4
        backward_repeat: True

    ##Freeze button DX
    Button:
        id: freeze_dx
        center_x: root.width - root.width / 8
        center_y: root.height - root.height / 12
        size: 35, 35
        background_normal: 'freeze.png'
        background_down: 'freezer.png'
        on_press:
            self.parent.freeze_ballDX()

    ##Freeze Label DX
    LabelChanging:
        id: label_freeze_dx
        text: "6"
        center_x: root.width - root.width / 8
        center_y: root.height - root.height / 12 + 2
        font_name: "Karantina_Regular"
        font_size: 35
        changing_interval: 0.12
        color_list: ["#4e075f", "#6a0a83", "#870ca6","#af0fd7","#ce40f2"]
        color_number_max: 4
        backward_repeat: True

    #Burst Button SX
    Button:
        id: burst_sx
        center_x: root.width / 5.4
        center_y: root.height / 12
        size: 35, 35
        background_normal: 'burst.png'
        background_down: 'burstr.png'
        on_press:
            self.parent.burst_ballSX()

    ##Burst Label SX
    LabelChanging:
        id: label_burst_sx
        text: "5"
        center_x: root.width / 5.4
        center_y: root.height / 12 + 2
        font_name: "Karantina_Regular"
        font_size: 35
        changing_interval: 0.12
        color_list: ["#4e075f", "#6a0a83", "#870ca6","#af0fd7","#ce40f2"]
        color_number_max: 4
        backward_repeat: True

    #Burst Button DX
    Button:
        id: burst_dx
        center_x: root.width - root.width / 5.4
        center_y: root.height - root.height / 12
        size: 35, 35
        background_normal: 'burst.png'
        background_down: 'burstr.png'
        on_press:
            self.parent.burst_ballDX()

    ##Burst Label DX
    LabelChanging:
        id: label_burst_dx
        text: "5"
        center_x: root.width - root.width / 5.4
        center_y: root.height - root.height / 12 + 2
        font_name: "Karantina_Regular"
        font_size: 35
        changing_interval: 0.12
        color_list: ["#4e075f", "#6a0a83", "#870ca6","#af0fd7","#ce40f2"]
        color_number_max: 4
        backward_repeat: True


    LabelChanging:
        font_size: 70
        center_x: root.width / 4
        top: root.top - 50
        text: str(root.player1.score)
        font_name: "Karantina_Regular"
        changing_interval: 0.12
        color_list: ["#00e600", "#00ff00", "#1aff1a"]
        color_number_max: 2
        backward_repeat: True

    LabelChanging:
        font_size: 70
        center_x: root.width * 3 / 4
        top: root.top - 50
        text: str(root.player2.score)
        font_name: "Karantina_Regular"
        changing_interval: 0.12
        color_list: ["#00e600", "#00ff00", "#1aff1a"]
        color_number_max: 2
        backward_repeat: True

    PongBall:
        id: pong_ball
        center: self.parent.center

    PongPaddle:
        id: player_left
        x: root.x
        center_y: root.center_y

    PongPaddle:
        id: player_right
        x: root.width - self.width
        center_y: root.center_y

    ##Punti SX
    LabelChanging:
        id: points_sx
        text: "0"
        center_x: root.width / 20
        center_y: root.height - root.height + 35
        font_name: "Karantina_Regular"
        font_size: 45
        bold: True
        changing_interval: 0.12
        color_list: ["#4e075f", "#6a0a83", "#870ca6","#af0fd7","#ce40f2"]
        color_number_max: 4
        backward_repeat: True

    ##Punti DX
    LabelChanging:
        id: points_dx
        text: "0"
        center_x: root.width - root.width / 20
        center_y: root.height - 35
        color: "purple"
        font_name: "Karantina_Regular"
        font_size: 45
        bold: True
        changing_interval: 0.12
        color_list: ["#4e075f", "#6a0a83", "#870ca6","#af0fd7","#ce40f2"]
        color_number_max: 4
        backward_repeat: True

    ProgressBar:
        id: prog_sx
        value: 0
        min: 0
        max: 10
        center_x: 120
        center_y: 20
        max_power_points: 10

    ProgressBar:
        id: prog_dx
        value: 0
        min: 0
        max: 10
        center_x: root.width - 120
        center_y: root.height - 20
        max_power_points: 10

